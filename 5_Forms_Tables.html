/**
 * 5_Forms_Tables
 * Formul√°rios e tabelas de dados
 * 
 * Consolidado em: 2025-10-21 01:14:28
 * Total de arquivos: 11
 * Total de linhas: 2410
 */


<!--============================================================================-->
<!-- ARQUIVO: Form-Alunos.html -->
<!--============================================================================-->

<!-- Form-Alunos.html - Fragmento de formul√°rio inclu√≠do no index.html -->
<div class="form-container"> <!-- Wrapper para o conte√∫do do formul√°rio -->

 <!-- Alerta: Crit√©rios de Atendimento -->
      <div class="alert alert-info mb-4" role="alert" >
        <i class="fas fa-info-circle"></i>
 <div>
 <strong>Portaria n¬∫ 192/2019 - Crit√©rios para Transporte Escolar:</strong>
          <p  class="mt-2" style="font-size: 0.9rem">O estudante deve ter de 4 a 17 anos, residir a mais de 2km da UE, em local sem transporte p√∫blico, n√£o ser benefici√°rio do Passe Livre Estudantil e possuir CPF pr√≥prio. Inclus√£o sujeita √† exist√™ncia de percurso e vaga no ve√≠culo.</p>
 </div>
 </div>

 <!-- Alerta: Penalidades e Responsabilidades -->
      <div class="alert alert-warning mb-4" role="alert" >
        <i class="fas fa-exclamation-triangle"></i>
 <div>
 <strong>Manual UNIAE/PP - Penalidades Importantes:</strong>
          <ul  style="margin: 0.5rem 0 0 1.5rem; font-size: 0.9rem; line-height: 1.6">
 <li><strong>10 faltas injustificadas</strong> (consecutivas ou alternadas) = Suspens√£o do transporte</li>
 <li><strong>1 m√™s de faltas consecutivas</strong> n√£o justificadas = Exclus√£o do aluno</li>
 <li><strong>Vedado usar transporte apenas na ida ou apenas na volta</strong> (exceto situa√ß√µes avaliadas pela GCOTE)</li>
 <li><strong>Menor de 12 anos:</strong> Respons√°vel deve acompanhar embarque/desembarque diariamente</li>
 <li><strong>Cadastro ativo no Passe Livre:</strong> Exclus√£o imediata do transporte locado</li>
 </ul>
 </div>
 </div>

      <form id="form-alunos" class="card-body">
 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-user"></i> Dados Pessoais</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="nome_completo" class="form-label">Nome Completo *</label>
              <input type="text" class="form-control" id="nome_completo-1" name="Nome_Completo" required>
 </div>
            <div class="form-group">
              <label for="ra_aluno" class="form-label">RA do Aluno *</label>
              <input type="text" class="form-control" id="ra_aluno-1" name="RA_Aluno" required>
 </div>
            <div class="form-group">
              <label for="data_nascimento" class="form-label">Data de Nascimento *</label>
              <input type="date" class="form-control" id="data_nascimento-1" name="Data_Nascimento" required onchange="calcularIdade()">
              <small class="form-help-text" id="idade-info-1"></small>
 </div>
            <div class="form-group">
              <label for="cpf" class="form-label">CPF * <i class="fas fa-exclamation-triangle"  style="color: var(--md-sys-color-error)" title="Obrigat√≥rio para uso do transporte escolar"></i></label>
              <input type="text" class="form-control" id="cpf-1" name="CPF" placeholder="000.000.000-00" required>
              <small class="form-help-text"  style="color: var(--md-sys-color-error)"><strong>Obrigat√≥rio:</strong> CPF pr√≥prio do estudante (Portaria 192/2019)</small>
 </div>
            <div class="form-group">
              <label for="rg" class="form-label">RG</label>
              <input type="text" class="form-control" id="rg-1" name="RG">
 </div>
 </div>
 </fieldset>

 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-school"></i> Dados Escolares</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="escola" class="form-label">Escola *</label>
              <input type="text" class="form-control" id="escola-1" name="Escola" required>
 </div>
            <div class="form-group">
              <label for="serie_ano" class="form-label">S√©rie/Ano *</label>
              <input type="text" class="form-control" id="serie_ano-1" name="Serie_Ano" placeholder="Ex: 8¬∫ Ano" required>
 </div>
            <div class="form-group">
              <label for="turno" class="form-label">Turno *</label>
              <select class="form-control" id="turno-1" name="Turno" required>
                <option value="">Selecione...</option>
                <option value="Matutino">Matutino</option>
                <option value="Vespertino">Vespertino</option>
                <option value="Integral">Integral</option>
                <option value="Noturno">Noturno</option>
 </select>
 </div>
 </div>
 </fieldset>

 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-map-marker-alt"></i> Endere√ßo</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="endereco_residencial" class="form-label">Endere√ßo Residencial * <i class="fas fa-info-circle" title="Dist√¢ncia m√≠nima de 2km da escola"></i></label>
              <input type="text" class="form-control" id="endereco_residencial-1" name="Endereco_Residencial" required>
              <small class="form-help-text">O aluno deve residir a mais de 2km da unidade escolar</small>
 </div>
            <div class="form-group">
              <label for="cep" class="form-label">CEP *</label>
              <input type="text" class="form-control" id="cep-1" name="CEP" placeholder="00000-000" required>
 </div>
            <div class="form-group">
              <label for="bairro" class="form-label">Bairro *</label>
              <input type="text" class="form-control" id="bairro-1" name="Bairro" required>
 </div>
 </div>
 </fieldset>

 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-bus"></i> Informa√ß√µes de Transporte</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="rota_id" class="form-label">Rota *</label>
              <select class="form-control" id="rota_id-1" name="ID_Rota" required>
                <option value="">Carregando rotas...</option>
 </select>
 </div>
            <div class="form-group">
              <label for="ponto_embarque" class="form-label">Ponto de Embarque</label>
              <input type="text" class="form-control" id="ponto_embarque-1" name="Ponto_Embarque">
 </div>
            <div class="form-group">
              <label for="ponto_desembarque" class="form-label">Ponto de Desembarque</label>
              <input type="text" class="form-control" id="ponto_desembarque-1" name="Ponto_Desembarque">
 </div>
 </div>
 </fieldset>

 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-user-friends"></i> Respons√°veis</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="responsavel1_nome" class="form-label">Respons√°vel 1 - Nome *</label>
              <input type="text" class="form-control" id="responsavel1_nome-1" name="Responsavel1_Nome" required>
 </div>
            <div class="form-group">
              <label for="responsavel1_telefone" class="form-label">Respons√°vel 1 - Telefone *</label>
              <input type="tel" class="form-control" id="responsavel1_telefone-1" name="Responsavel1_Telefone" placeholder="(00) 00000-0000" required>
 </div>
            <div class="form-group">
              <label for="responsavel2_nome" class="form-label">Respons√°vel 2 - Nome</label>
              <input type="text" class="form-control" id="responsavel2_nome-1" name="Responsavel2_Nome">
 </div>
            <div class="form-group">
              <label for="responsavel2_telefone" class="form-label">Respons√°vel 2 - Telefone</label>
              <input type="tel" class="form-control" id="responsavel2_telefone-1" name="Responsavel2_Telefone" placeholder="(00) 00000-0000">
 </div>
 </div>
 </fieldset>

 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-info-circle"></i> Informa√ß√µes Adicionais</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="necessidades_especiais" class="form-label">Necessidades Especiais</label>
              <select class="form-control" id="necessidades_especiais-1" name="Necessidades_Especiais" onchange="toggleNecessidadesDetalhes()">
                <option value="N√£o">N√£o</option>
                <option value="Sim">Sim</option>
 </select>
 </div>
            <div class="form-group" id="tipo_necessidade_group-1"  style="display: none">
              <label for="tipo_necessidade" class="form-label">Tipo de Necessidade <i class="fas fa-wheelchair"  style="color: var(--md-sys-color-primary)"></i></label>
              <select class="form-control" id="tipo_necessidade-1" name="Tipo_Necessidade" onchange="toggleCadeirante()">
                <option value="">Selecione...</option>
                <option value="Cadeirante">‚ôø Cadeirante (necessita baia)</option>
                <option value="Mobilidade Reduzida">ü¶Ω Mobilidade Reduzida</option>
                <option value="Visual">üëÅÔ∏è Defici√™ncia Visual</option>
                <option value="Auditiva">üëÇ Defici√™ncia Auditiva</option>
                <option value="Intelectual">üß† Defici√™ncia Intelectual</option>
                <option value="TEA">üß© Transtorno do Espectro Autista</option>
                <option value="M√∫ltipla">‚ôø Defici√™ncia M√∫ltipla</option>
                <option value="Outra">Outra</option>
 </select>
 </div>
            <div class="form-group" id="requer_baia_group-1"  style="display: none">
              <label for="requer_baia" class="form-label">√â Cadeirante? <span class="required">*</span></label>
              <select class="form-control" id="requer_baia-1" name="Requer_Baia_Cadeirante">
                <option value="N√£o">N√£o</option>
                <option value="Sim">‚ôø Sim - Necessita baia espec√≠fica</option>
 </select>
              <small class="form-help-text"  style="color: var(--md-sys-color-error)"><strong>CENSO:</strong> Informar se o aluno √© cadeirante conforme Manual UNIAE/PP</small>
 </div>
            <div class="form-group" id="necessita_acompanhante_group-1"  style="display: none">
              <label for="necessita_acompanhante" class="form-label">Necessita de Acompanhante no √înibus?</label>
              <select class="form-control" id="necessita_acompanhante-1" name="Necessita_Acompanhante">
                <option value="N√£o">N√£o</option>
                <option value="Sim">Sim - Requer acompanhante</option>
 </select>
 </div>
            <div class="form-group" id="laudo_medico_group-1"  style="display: none">
              <label for="laudo_medico" class="form-label">Apresentou Laudo M√©dico?</label>
              <select class="form-control" id="laudo_medico-1" name="Laudo_Medico_Apresentado">
                <option value="N√£o">N√£o</option>
                <option value="Sim">Sim</option>
 </select>
 </div>
            <div class="form-group">
              <label for="status_ativo" class="form-label">Status</label>
              <select class="form-control" id="status_ativo-1" name="Status_Ativo">
                <option value="Ativo">Ativo</option>
                <option value="Inativo">Inativo</option>
                <option value="Transferido">Transferido</option>
 </select>
 </div>
            <div class="form-group"  style="grid-column: 1 / -1">
              <label for="descricao_necessidade" class="form-label">Descri√ß√£o Detalhada da Necessidade</label>
              <textarea class="form-control" id="descricao_necessidade-1" name="Descricao_Necessidade" rows="2" placeholder="Detalhe a necessidade espec√≠fica do estudante..."></textarea>
 </div>
            <div class="form-group"  style="grid-column: 1 / -1">
              <label for="medicamentos" class="form-label">Medicamentos/Observa√ß√µes M√©dicas</label>
              <textarea class="form-control" id="medicamentos-1" name="Medicamentos" rows="3" placeholder="Liste medicamentos de uso cont√≠nuo, alergias, restri√ß√µes m√©dicas..."></textarea>
 </div>
 </div>
 </fieldset>

 <!-- Fun√ß√µes auxiliares para comportamento din√¢mico dos campos -->
 <script>
 function calcularIdade() {
   const dataNasc = new Date(document.getElementById('data_nascimento').value);
   const hoje = new Date();
   let idade = hoje.getFullYear() - dataNasc.getFullYear();
   const m = hoje.getMonth() - dataNasc.getMonth();
   if (m < 0 || (m === 0 && hoje.getDate() < dataNasc.getDate())) {
     idade--;
   }

   const infoEl = document.getElementById('idade-info');
   if (idade < 12) {
     infoEl.innerHTML = '<strong  style="color: var(--md-sys-color-warning)">‚ö†Ô∏è Menor de 12 anos: Respons√°vel deve acompanhar embarque/desembarque diariamente</strong>';
   } else {
     infoEl.innerHTML = `Idade: ${idade} anos`;
   }
 }

 function toggleNecessidadesDetalhes() {
   const necessidades = document.getElementById('necessidades_especiais').value;
   const tipoGroup = document.getElementById('tipo_necessidade_group');
   const baiaGroup = document.getElementById('requer_baia_group');
   const acompanhanteGroup = document.getElementById('necessita_acompanhante_group');
   const laudoGroup = document.getElementById('laudo_medico_group');

   if (necessidades === 'Sim') {
     tipoGroup.style.display = 'block';
     acompanhanteGroup.style.display = 'block';
     laudoGroup.style.display = 'block';
   } else {
     tipoGroup.style.display = 'none';
     baiaGroup.style.display = 'none';
     acompanhanteGroup.style.display = 'none';
     laudoGroup.style.display = 'none';
     document.getElementById('tipo_necessidade').value = '';
     document.getElementById('requer_baia').value = 'N√£o';
     document.getElementById('necessita_acompanhante').value = 'N√£o';
     document.getElementById('laudo_medico').value = 'N√£o';
   }
 }

 function toggleCadeirante() {
   const tipo = document.getElementById('tipo_necessidade').value;
   const baiaGroup = document.getElementById('requer_baia_group');

   if (tipo === 'Cadeirante' || tipo === 'Mobilidade Reduzida' || tipo === 'M√∫ltipla') {
     baiaGroup.style.display = 'block';
     if (tipo === 'Cadeirante') {
       document.getElementById('requer_baia').value = 'Sim';
     }
   } else {
     baiaGroup.style.display = 'none';
     document.getElementById('requer_baia').value = 'N√£o';
   }
 }
 </script>
 </form>
</div>



<!--============================================================================-->
<!-- ARQUIVO: Form-Eventos.html -->
<!--============================================================================-->

<!-- Form-Eventos.html - Fragmento inclu√≠do no index.html -->
<div class="container">
    <h2 class="page-title"><i class="fas fa-calendar-plus"></i> Cadastro de Evento</h2>
    <p class="page-subtitle">Registre um novo evento, passeio ou atividade extracurricular.</p>

 <!-- Alerta: Prazo de Solicita√ß√£o -->
    <div class="alert alert-warning mb-4" role="alert" >
      <i class="fas fa-clock"></i>
 <div>
 <strong>Manual UNIAE/PP - Prazos de Solicita√ß√£o:</strong>
        <p  class="mt-2" style="font-size: 0.9rem">
 <strong>REPOSI√á√ÉO:</strong> M√≠nimo de 5 dias √∫teis antes da data.<br>
 <strong>ATIVIDADES EXTRACURRICULARES:</strong> M√≠nimo de 15 dias de anteced√™ncia.<br>
 Comunique cancelamentos imediatamente para evitar custos desnecess√°rios ao er√°rio.
 </p>
 </div>
 </div>

    <div class="card">
      <form id="evento-form" class="card-body" onsubmit="handleFormSubmit(event)">
        <fieldset class="form-section">
          <legend class="section-title-standardized"><i class="fas fa-info-circle"></i> Detalhes do Evento</legend>
          <div class="w-full form-grid">
            <div class="form-group"  style="grid-column: 1 / -1">
              <label for="titulo" class="form-label">T√≠tulo do Evento *</label>
              <input type="text" class="form-control" id="titulo" name="Titulo" placeholder="Ex: Visita ao Planet√°rio" required>
 </div>
            <div class="form-group"  style="grid-column: 1 / -1">
              <label for="descricao" class="form-label">Descri√ß√£o *</label>
              <textarea class="form-control" id="descricao-1" name="Descricao" rows="3" placeholder="Descreva o objetivo e os detalhes do evento" required></textarea>
 </div>
            <div class="form-group">
              <label for="tipo" class="form-label">Tipo de Evento *</label>
              <select class="form-control" id="tipo" name="Tipo" required>
                <option value="">Selecione o tipo...</option>
                <option value="Passeio">Passeio</option>
                <option value="Atividade Extracurricular">Atividade Extracurricular</option>
                <option value="Reuni√£o">Reuni√£o</option>
                <option value="Manuten√ß√£o Programada">Manuten√ß√£o Programada</option>
                <option value="Outro">Outro</option>
 </select>
 </div>
            <div class="form-group">
              <label for="status" class="form-label">Status *</label>
              <select class="form-control" id="status-2" name="Status" required>
                <option value="Agendado" selected>Agendado</option>
                <option value="Confirmado">Confirmado</option>
                <option value="Cancelado">Cancelado</option>
                <option value="Conclu√≠do">Conclu√≠do</option>
 </select>
 </div>
 </div>
 </fieldset>

        <fieldset class="form-section">
          <legend class="section-title-standardized"><i class="fas fa-calendar-day"></i> Data e Hora</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="data_evento" class="form-label">Data do Evento *</label>
              <input type="date" class="form-control" id="data_evento" name="Data" required>
 </div>
            <div class="form-group">
              <label for="horario_inicio" class="form-label">Hor√°rio de In√≠cio *</label>
              <input type="time" class="form-control" id="horario_inicio-1" name="Horario_Inicio" required>
 </div>
            <div class="form-group">
              <label for="horario_fim" class="form-label">Hor√°rio de T√©rmino</label>
              <input type="time" class="form-control" id="horario_fim-1" name="Horario_Fim">
 </div>
 </div>
 </fieldset>

        <fieldset class="form-section">
          <legend class="section-title-standardized"><i class="fas fa-map-marked-alt"></i> Localiza√ß√£o e Log√≠stica</legend>
          <div class="w-full form-grid">
            <div class="form-group"  style="grid-column: 1 / -1">
              <label for="local" class="form-label">Local do Evento *</label>
              <input type="text" class="form-control" id="local" name="Local" placeholder="Ex: Planet√°rio de Bras√≠lia" required>
 </div>
            <div class="form-group">
              <label for="id_rota" class="form-label">Rota Associada (se aplic√°vel)</label>
              <select class="form-control" id="id_rota-1" name="ID_Rota">
                <option value="">Nenhuma rota espec√≠fica...</option>
 </select>
 </div>
            <div class="form-group">
              <label for="id_veiculo" class="form-label">Ve√≠culo Necess√°rio</label>
              <select class="form-control" id="id_veiculo-1" name="ID_Veiculo">
                <option value="">Nenhum ve√≠culo espec√≠fico...</option>
 </select>
 </div>
            <div class="form-group">
              <label for="alunos_participantes" class="form-label">N¬∫ de Alunos Participantes</label>
              <input type="number" class="form-control" id="alunos_participantes" name="Alunos_Participantes" min="0">
 </div>
 </div>
 </fieldset>

        <fieldset class="form-section">
          <legend class="section-title-standardized"><i class="fas fa-user-check"></i> Respons√°veis</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="responsavel_evento" class="form-label">Respons√°vel pelo Evento *</label>
              <input type="text" class="form-control" id="responsavel_evento" name="Responsavel_Evento" placeholder="Nome do professor ou coordenador" required>
 </div>
            <div class="form-group">
              <label for="contato_responsavel" class="form-label">Contato do Respons√°vel *</label>
              <input type="tel" class="form-control" id="contato_responsavel" name="Contato_Responsavel" placeholder="(61) 99999-9999" required>
 </div>
 </div>
 </fieldset>

        <div class="card-footer">
          <button type="button" class="btn btn-secondary" onclick="google.script.host.close()">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar Evento</button>
 </div>
 </form>
 </div>
 </div>
 <script>
    document.addEventListener('DOMContentLoaded', function() {
 // Define a data de hoje como padr√£o
 const today = new Date();
      const futureDate = new Date(today.setDate(today.getDate() + 15)).toISOString().split('T')[0];
      document.getElementById('data_evento').value = futureDate;

 // Carrega os dados dos selects
 populateSelects();
 });

 async function populateSelects() {
      const rotaSelect = document.getElementById('id_rota');
      const vehicleSelect = document.getElementById('id_veiculo');

 try {
 // Usando Promise.all para carregar dados em paralelo
 const [rotaResult, vehicleResult] = await Promise.all([
          API.run('readRecords', { sheetName: 'Rotas', filters: { Status: 'Ativa' } }),
          API.run('readRecords', { sheetName: 'Veiculos', filters: { Status: 'Operacional' } })
 ]);

 // Popula rotas
 (rotaResult || []).forEach(rota => {
 const option = new Option(`${rota.Codigo} - ${rota.Nome_Rota}`, rota.ID);
 rotaSelect.add(option);
 });

 // Popula ve√≠culos
 (vehicleResult || []).forEach(veiculo => {
 const option = new Option(`${veiculo.Placa} - ${veiculo.Modelo}`, veiculo.ID);
 vehicleSelect.add(option);
 });

 } catch (error) {
        console.error('Erro ao popular selects:', error);
        ToastManager.show(`Falha ao carregar op√ß√µes: ${error.message}`, 'error');

        rotaSelect.innerHTML = '<option value="">Falha ao carregar rotas</option>';
 rotaSelect.disabled = true;
        vehicleSelect.innerHTML = '<option value="">Falha ao carregar ve√≠culos</option>';
 vehicleSelect.disabled = true;
 }
 }

 async function handleFormSubmit(e) {
 e.preventDefault();
      const form = document.getElementById('evento-form');

 // Valida√ß√£o do formul√°rio
 if (!form.checkValidity()) {
        ToastManager.show('Por favor, preencha todos os campos obrigat√≥rios.', 'warning');
 form.reportValidity();
 return;
 }

 const formData = new FormData(form);
 const eventoData = Object.fromEntries(formData.entries());

      const submitButton = form.querySelector('button[type="submit"]');
 LoadingManager.showButtonLoading(submitButton);

 try {
        const result = await API.run('createRecord', { sheetName: 'Eventos', data: eventoData });
 if (result.success) {
            ToastManager.show('Evento registrado com sucesso!', 'success');
 form.reset();

 // Define a data futura novamente ap√≥s o reset
 const today = new Date();
            const futureDate = new Date(today.setDate(today.getDate() + 15)).toISOString().split('T')[0];
            document.getElementById('data_evento').value = futureDate;

 // Fecha o modal/dialog
            if (window.parent && typeof window.parent.ModalManager.close === 'function') {
              window.parent.ModalManager.close('form-evento-modal');
              window.parent.CRUDManagerUniversal.loadData('eventos');
            } else if (typeof google.script.host.close === 'function') {
 google.script.host.close();
 }
 } else {
            throw new Error(result.error || "O servidor retornou uma falha ao salvar o evento.");
 }

 } catch (error) {
        console.error('Erro ao salvar evento:', error);
        ToastManager.show(`Erro ao salvar: ${error.message}`, 'error');
 } finally {
 LoadingManager.hideButtonLoading(submitButton);
 }
 }
 </script>



<!--============================================================================-->
<!-- ARQUIVO: Form-Frequencia.html -->
<!--============================================================================-->

<!-- Form-Frequencia.html - Fragmento inclu√≠do no index.html -->
<div class="container">
    <h2><i class="fas fa-calendar-check"></i> Registro de Frequ√™ncia</h2>
    <p class="text-muted">Registre a presen√ßa dos alunos no transporte escolar.</p>
 <!-- Alerta: Responsabilidade Legal -->
    <div class="alert alert-warning mb-4" role="alert" >
      <i class="fas fa-exclamation-triangle"></i>
 <div>
 <strong>Portaria n¬∫ 20/2022 - Responsabilidade das Unidades Escolares:</strong>
        <p  class="mt-2" style="font-size: 0.9rem">As informa√ß√µes nas planilhas de frequ√™ncia s√£o de inteira responsabilidade das UEs. Confira e ateste via SEI somente se as informa√ß√µes estiverem condizentes com os controles da escola. O servidor responde administrativa, civil e penalmente por informa√ß√µes incorretas (LC 840/2011).</p>
 </div>
 </div>

    <form id="frequenciaForm">
 <!-- NOTA: Este formul√°rio registra frequ√™ncia por VIAGEM, n√£o por dia.
 Os campos de Viagem (Data, Rota, Ve√≠culo, etc) devem ser selecionados
 de uma viagem existente ou criar uma nova viagem antes. -->

      <div class="form-group">
        <label for="id_viagem">Viagem * <i class="fas fa-info-circle" title="Ateste somente se as informa√ß√µes forem corretas"></i></label>
        <select class="form-control" id="id_viagem" name="ID_Viagem" required>
          <option value="">Selecione a viagem...</option>
 <!-- Viagens carregadas dinamicamente com Data + Rota + Per√≠odo -->
 </select>
        <small class="form-help-text">Selecione a viagem para registrar frequ√™ncia dos alunos. Confira antes de atestar.</small>
 </div>

 <fieldset>
 <legend>Lista de Presen√ßa</legend>
        <div class="attendance-header">
            <div class="attendance-actions">
                <button type="button" class="btn btn-sm btn-success" id="mark-all-present-btn"><i class="fas fa-check-double"></i> Marcar Todos Presentes</button>
                <button type="button" class="btn btn-sm btn-warning" id="mark-all-absent-btn"><i class="fas fa-times"></i> Marcar Todos Ausentes</button>
 </div>
 </div>
        <div id="students-attendance-list-1" class="student-attendance-list">
            <div class="student-attendance-placeholder">
                <i class="fas fa-users"></i>
 <p>Selecione uma viagem para carregar a lista de alunos.</p>
 </div>
 </div>
 <!--
 Para cada aluno, os seguintes campos ser√£o registrados:
 - ID_Aluno (hidden)
 - Status_Presenca (radio: Presente/Ausente/Falta)
 - Horario_Embarque (time, opcional)
 - Horario_Desembarque (time, opcional)
 - Observacoes_Aluno (text, opcional)
 - Justificativa_Ausencia (text, se ausente)
 -->
 </fieldset>

      <div class="card-footer">
        <button type="button" class="btn btn-secondary" onclick="limparFormulario()">Limpar</button>
        <button type="submit" class="btn btn-primary" id="save-attendance-btn">Salvar Frequ√™ncia</button>
 </div>
 </form>
</div>



<!--============================================================================-->
<!-- ARQUIVO: Form-Manutencao.html -->
<!--============================================================================-->

<!-- ============================================================================
 FORM-MANUTENCAO.HTML
 Formul√°rio customizado para registro de manuten√ß√£o de ve√≠culos
 ============================================================================ -->
<div class="form-manutencao-container" data-form-type="manutencao">

 <!-- Alerta: Import√¢ncia da Manuten√ß√£o Preventiva -->
    <div class="alert alert-warning mb-4" role="alert" >
      <i class="fas fa-tools"></i>
 <div>
 <strong>Manuten√ß√£o Preventiva - Seguran√ßa dos Estudantes:</strong>
        <p  class="mt-2" style="font-size: 0.9rem">Mantenha o cronograma de revis√µes em dia. Ve√≠culos com manuten√ß√£o preventiva adequada reduzem acidentes e custos operacionais. Documente todas as interven√ß√µes para comprova√ß√£o junto √† TCB e GCOTE.</p>
 </div>
 </div>

    <form id="form-manutencao-1" class="form-grid">

 <!-- Identifica√ß√£o do Servi√ßo -->
        <fieldset class="form-section full-width">
            <legend class="section-title">
                <i class="fas fa-wrench"></i> Identifica√ß√£o do Servi√ßo
 </legend>

            <div class="w-full form-grid">
                <div class="form-group">
                    <label for="manutencao-veiculo" class="form-label">
                        Ve√≠culo <span class="required">*</span>
 </label>
                    <select id="manutencao-veiculo-1" name="ID_Veiculo" class="form-control" required>
                        <option value="">Selecione o ve√≠culo...</option>
 <!-- Op√ß√µes carregadas dinamicamente -->
 </select>
 </div>

                <div class="form-group">
                    <label for="manutencao-tipo" class="form-label">
                        Tipo de Manuten√ß√£o <span class="required">*</span>
 </label>
                    <select id="manutencao-tipo-1" name="Tipo_Manutencao" class="form-control" required>
                        <option value="">Selecione...</option>
                        <option value="Preventiva">üîß Preventiva</option>
                        <option value="Corretiva">üî® Corretiva</option>
                        <option value="Emergencial">üö® Emergencial</option>
                        <option value="Preditiva">üìä Preditiva</option>
                        <option value="Revis√£o">‚úÖ Revis√£o</option>
 </select>
 </div>

                <div class="form-group">
                    <label for="manutencao-prioridade" class="form-label">
                        Prioridade <span class="required">*</span>
 </label>
                    <select id="manutencao-prioridade-1" name="Prioridade" class="form-control" required>
                        <option value="">Selecione...</option>
                        <option value="Baixa">üü¢ Baixa</option>
                        <option value="M√©dia">üü° M√©dia</option>
                        <option value="Alta">üü† Alta</option>
                        <option value="Cr√≠tica">üî¥ Cr√≠tica</option>
 </select>
 </div>

                <div class="form-group">
                    <label for="manutencao-status" class="form-label">
                        Status <span class="required">*</span>
 </label>
                    <select id="manutencao-status-1" name="Status" class="form-control" required>
                        <option value="Agendada">üìÖ Agendada</option>
                        <option value="Em Andamento">‚è≥ Em Andamento</option>
                        <option value="Conclu√≠da">‚úÖ Conclu√≠da</option>
                        <option value="Cancelada">‚ùå Cancelada</option>
                        <option value="Adiada">‚è∏Ô∏è Adiada</option>
 </select>
 </div>

                <div class="form-group">
                    <label for="manutencao-data-servico" class="form-label">
                        Data do Servi√ßo <span class="required">*</span>
 </label>
 <input
                        type="date"
                        id="manutencao-data-servico-1"
                        name="Data_Servico"
                        class="form-control"
 required
 >
 </div>

                <div class="form-group">
                    <label for="manutencao-data-realizada" class="form-label">
 Data Realizada
 </label>
 <input
                        type="date"
                        id="manutencao-data-realizada-1"
                        name="Data_Realizada"
                        class="form-control"
 >
 </div>
 </div>
 </fieldset>

 <!-- Dados da Quilometragem -->
        <fieldset class="form-section full-width">
            <legend class="section-title">
                <i class="fas fa-tachometer-alt"></i> Quilometragem
 </legend>

            <div class="w-full form-grid">
                <div class="form-group">
                    <label for="manutencao-km-servico" class="form-label">
                        KM no Servi√ßo <span class="required">*</span>
 </label>
 <input
                        type="number"
                        id="manutencao-km-servico-1"
                        name="KM_Servico"
                        class="form-control"
                        min="0"
 required
                        placeholder="Ex: 45230"
 >
                    <small class="form-help-text" id="manutencao-km-atual-info-1"></small>
 </div>

                <div class="form-group">
                    <label for="manutencao-intervalo-km" class="form-label">
 Intervalo para Pr√≥ximo Servi√ßo (KM)
 </label>
 <input
                        type="number"
                        id="manutencao-intervalo-km"
                        name="Proximo_Servico_KM"
                        class="form-control"
                        min="0"
                        placeholder="Ex: 10000"
 readonly
                         style="display:none"
 >
                    <small class="form-help-text">Campo calculado automaticamente baseado no KM atual + intervalo</small>
 </div>

                <div class="form-group">
                    <label for="manutencao-proximo-km" class="form-label">
 Pr√≥ximo Servi√ßo (KM)
                        <i class="fas fa-calculator text-info" title="Calculado automaticamente"></i>
 </label>
 <input
                        type="number"
                        id="manutencao-proximo-km-1"
                        name="Proximo_Servico_KM"
                        class="form-control"
 readonly
                         style="background-color: var(--surface-hover)"
 >
 </div>

                <div class="form-group">
                    <label for="manutencao-proximo-data" class="form-label">
 Pr√≥xima Data Prevista
 </label>
 <input
                        type="date"
                        id="manutencao-proximo-data-1"
                        name="Proximo_Servico_Data"
                        class="form-control"
 >
 </div>
 </div>
 </fieldset>

 <!-- Descri√ß√£o do Servi√ßo -->
        <fieldset class="form-section full-width">
            <legend class="section-title">
                <i class="fas fa-clipboard-list"></i> Descri√ß√£o do Servi√ßo
 </legend>

            <div class="form-group full-width">
                <label for="manutencao-descricao" class="form-label">
                    Descri√ß√£o Detalhada <span class="required">*</span>
 </label>
 <textarea
                    id="manutencao-descricao-1"
                    name="Descricao"
                    class="form-control"
                    rows="4"
 required
                    placeholder="Descreva os servi√ßos realizados ou a serem realizados..."
 ></textarea>
 </div>

            <div class="form-group full-width">
                <label for="manutencao-observacoes" class="form-label">
 Observa√ß√µes Adicionais
 </label>
 <textarea
                    id="manutencao-observacoes-1"
                    name="Observacoes"
                    class="form-control"
                    rows="3"
                    placeholder="Informa√ß√µes complementares, problemas encontrados, recomenda√ß√µes..."
 ></textarea>
 </div>
 </fieldset>

 <!-- Informa√ß√µes Financeiras -->
        <fieldset class="form-section full-width">
            <legend class="section-title">
                <i class="fas fa-dollar-sign"></i> Informa√ß√µes Financeiras
 </legend>

            <div class="w-full form-grid">
                <div class="form-group">
                    <label for="manutencao-valor" class="form-label">
                        Valor (R$) <span class="required">*</span>
 </label>
 <input
                        type="number"
                        id="manutencao-valor-1"
                        name="Valor"
                        class="form-control"
                        min="0"
                        step="0.01"
 required
                        placeholder="0,00"
 >
 </div>

                <div class="form-group">
                    <label for="manutencao-fornecedor" class="form-label">
                        Fornecedor <span class="required">*</span>
 </label>
 <input
                        type="text"
                        id="manutencao-fornecedor-1"
                        name="Fornecedor"
                        class="form-control"
 required
                        placeholder="Nome da oficina ou fornecedor"
 >
 </div>

                <div class="form-group">
                    <label for="manutencao-responsavel" class="form-label">
 Respons√°vel pelo Servi√ßo
 </label>
 <input
                        type="text"
                        id="manutencao-responsavel-1"
                        name="Responsavel"
                        class="form-control"
                        placeholder="Nome do mec√¢nico ou respons√°vel"
 >
 </div>
 </div>
 </fieldset>

 </form>
</div>

<script>
// Inicializa√ß√£o espec√≠fica do formul√°rio de manuten√ß√£o
(function() {
    'use strict';

 // Carrega ve√≠culos
 async function loadVeiculos() {
 try {
            const veiculosSelect = document.getElementById('manutencao-veiculo');
 if (!veiculosSelect || !window.API) return;

            const veiculos = await window.API.run('readRecords', { sheetName: 'Veiculos' });
 if (Array.isArray(veiculos)) {
                veiculosSelect.innerHTML = '<option value="">Selecione o ve√≠culo...</option>';
 veiculos.forEach(veiculo => {
                    const option = document.createElement('option');
 option.value = veiculo.ID;
                    option.textContent = `${veiculo.Placa || veiculo.ID} - ${veiculo.Modelo || ''} (${veiculo.KM_Atual || '?'} km)`;
 option.dataset.kmAtual = veiculo.KM_Atual || 0;
 veiculosSelect.appendChild(option);
 });
 }
 } catch (error) {
            console.error('[Form-Manutencao] Erro ao carregar ve√≠culos:', error);
 }
 }

 // Preenche KM atual ao selecionar ve√≠culo
    const veiculoSelect = document.getElementById('manutencao-veiculo');
    const kmServicoInput = document.getElementById('manutencao-km-servico');
    const kmAtualInfo = document.getElementById('manutencao-km-atual-info');

 if (veiculoSelect && kmServicoInput) {
        veiculoSelect.addEventListener('change', function() {
 const selectedOption = this.options[this.selectedIndex];
 const kmAtual = selectedOption.dataset.kmAtual || 0;

 if (kmAtual > 0) {
 kmServicoInput.value = kmAtual;
 if (kmAtualInfo) {
 kmAtualInfo.textContent = `KM atual do ve√≠culo: ${kmAtual} km`;
                    kmAtualInfo.className = 'form-help-text text-info';
 }
 }
 });
 }

 // C√°lculo autom√°tico: Pr√≥ximo Servi√ßo KM
    const intervaloKmInput = document.getElementById('manutencao-intervalo-km');
    const proximoKmInput = document.getElementById('manutencao-proximo-km');

 function calcularProximoKm() {
 if (!kmServicoInput || !intervaloKmInput || !proximoKmInput) return;

 const kmServico = parseFloat(kmServicoInput.value) || 0;
 const intervalo = parseFloat(intervaloKmInput.value) || 0;

 if (kmServico > 0 && intervalo > 0) {
 proximoKmInput.value = kmServico + intervalo;
 } else {
            proximoKmInput.value = '';
 }
 }

 if (kmServicoInput && intervaloKmInput) {
        kmServicoInput.addEventListener('input', calcularProximoKm);
        intervaloKmInput.addEventListener('input', calcularProximoKm);
 }

 // Formata√ß√£o de valor monet√°rio
    const valorInput = document.getElementById('manutencao-valor');
 if (valorInput) {
        valorInput.addEventListener('blur', function() {
 if (this.value) {
 this.value = parseFloat(this.value).toFixed(2);
 }
 });
 }

 // Valida√ß√£o: Data Realizada n√£o pode ser futura
    const dataRealizadaInput = document.getElementById('manutencao-data-realizada');
 if (dataRealizadaInput) {
        dataRealizadaInput.addEventListener('change', function() {
            const hoje = new Date().toISOString().split('T')[0];
 if (this.value > hoje) {
                this.setCustomValidity('Data realizada n√£o pode ser no futuro');
 this.reportValidity();
 } else {
                this.setCustomValidity('');
 }
 });
 }

 // Inicializa campos calculados quando dispon√≠vel
 if (window.CalculatedFieldsManager) {
        CalculatedFieldsManager.calculations['manutencao'] = [
 {
                inputs: ['manutencao-km-servico', 'manutencao-intervalo-km'],
                output: 'manutencao-proximo-km',
 calculate: (kmAtual, intervalo) => {
 const km = parseFloat(kmAtual) || 0;
 const int = parseFloat(intervalo) || 0;
                    return km > 0 && int > 0 ? (km + int).toFixed(0) : '';
 }
 }
 ];
        CalculatedFieldsManager.init('manutencao');
 }

 // Carrega dados iniciais
    if (document.getElementById('form-manutencao')) {
 loadVeiculos();
 } else {
        document.addEventListener('DOMContentLoaded', loadVeiculos);
 }

    console.log('[Form-Manutencao] Formul√°rio inicializado');
})();
</script>

<style>
.form-manutencao-container .form-section {
 background: var(--surface-color);
 padding: var(--space-4);
 border-radius: var(--radius-lg);
 margin-bottom: var(--space-4);
 border-left: 4px solid var(--primary-color);
}

.form-manutencao-container .section-title {
 font-size: 1.1rem;
 font-weight: 600;
 margin-bottom: var(--space-3);
 color: var(--primary-color);
 display: flex;
 align-items: center;
 gap: var(--space-2);
}

.form-manutencao-container .full-width {
 grid-column: 1 / -1;
}

.form-manutencao-container .text-info {
 color: var(--info-color);
 font-weight: 500;
}
</style>



<!--============================================================================-->
<!-- ARQUIVO: Form-Pessoal.html -->
<!--============================================================================-->

<!-- Form-Pessoal.html - Fragmento de formul√°rio inclu√≠do no index.html via formUrl -->
<div class="form-container"> <!-- Wrapper para o conte√∫do do formul√°rio -->

 <!-- Alerta: Documenta√ß√£o de M√£o de Obra -->
    <div class="alert alert-info mb-4" role="alert" >
      <i class="fas fa-users"></i>
 <div>
 <strong>Termo de Refer√™ncia - Documenta√ß√£o da M√£o de Obra:</strong>
        <p  class="mt-2" style="font-size: 0.9rem">Devem ser apresentadas mensalmente: Folhas de ponto dos funcion√°rios, Folha de Pagamento, Rela√ß√£o de Funcion√°rios, Vale transporte e Vale refei√ß√£o. Mantenha os cadastros atualizados para garantir conformidade e pagamentos.</p>
 </div>
 </div>

 <!-- Alerta: Compet√™ncias de Monitores e Motoristas -->
    <div class="alert alert-warning mb-4" role="alert" >
      <i class="fas fa-clipboard-check"></i>
 <div>
 <strong>Manual UNIAE/PP - Compet√™ncias Obrigat√≥rias:</strong>
        <ul  style="margin: 0.5rem 0 0 1.5rem; font-size: 0.9rem; line-height: 1.6">
 <li>Apresentar-se <strong>uniformizado e com crach√° de identifica√ß√£o</strong></li>
 <li>Registrar e atestar presen√ßa dos estudantes na frequ√™ncia veicular</li>
 <li>Usar <strong>di√°rio de bordo diariamente</strong> (obrigat√≥rio)</li>
 <li><strong>N√£o permitir embarque</strong> de estudantes fora da lista oficial</li>
 <li><strong>N√£o dar carona</strong> e <strong>n√£o transportar alunos em p√©</strong></li>
 <li>Conferir uso correto do cinto de seguran√ßa por todos</li>
 </ul>
 </div>
 </div>

      <form id="pessoalForm-1" class="card-body">
 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-user"></i> Dados Pessoais</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="nome_completo" class="form-label">Nome Completo *</label>
              <input type="text" class="form-control" id="nome_completo-1" name="Nome_Completo" required>
 </div>
            <div class="form-group">
              <label for="cpf" class="form-label">CPF *</label>
              <input type="text" class="form-control" id="cpf-1" name="CPF" placeholder="000.000.000-00" required>
 </div>
            <div class="form-group">
              <label for="rg" class="form-label">RG *</label>
              <input type="text" class="form-control" id="rg-1" name="RG" required>
 </div>
            <div class="form-group">
              <label for="data_nascimento" class="form-label">Data de Nascimento *</label>
              <input type="date" class="form-control" id="data_nascimento-1" name="Data_Nascimento" required>
 </div>
            <div class="form-group">
              <label for="telefone" class="form-label">Telefone *</label>
              <input type="tel" class="form-control" id="telefone" name="Telefone" placeholder="(00) 00000-0000" required>
 </div>
            <div class="form-group">
              <label for="email" class="form-label">E-mail *</label>
              <input type="email" class="form-control" id="email" name="Email" required>
 </div>
 </div>
 </fieldset>

 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-briefcase"></i> Dados Profissionais</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="cargo" class="form-label">Cargo *</label>
              <select class="form-control" id="cargo" name="Cargo" required onchange="toggleCNHFields()">
                <option value="">Selecione...</option>
                <option value="Motorista">Motorista</option>
                <option value="Monitor">Monitor</option>
 </select>
 </div>
            <div class="form-group">
              <label for="status_contrato" class="form-label">Status do Contrato *</label>
              <select class="form-control" id="status_contrato" name="Status_Contrato" required>
                <option value="ATIVO">Ativo</option>
                <option value="INATIVO">Inativo</option>
                <option value="AFASTADO">Afastado</option>
                <option value="FERIAS">F√©rias</option>
                <option value="SUSPENSO">Suspenso</option>
 </select>
 </div>
            <div class="form-group">
              <label for="data_admissao" class="form-label">Data de Admiss√£o *</label>
              <input type="date" class="form-control" id="data_admissao" name="Data_Admissao" required>
 </div>
 </div>
 </fieldset>

        <fieldset id="cnhFields"  style="display:none">
          <legend class="section-title-standardized"><i class="fas fa-id-card-alt"></i> Carteira Nacional de Habilita√ß√£o (CNH)</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="cnh_numero" class="form-label">N√∫mero da CNH</label>
              <input type="text" class="form-control" id="cnh_numero" name="CNH_Numero">
 </div>
            <div class="form-group">
              <label for="cnh_categoria" class="form-label">Categoria da CNH</label>
              <select class="form-control" id="cnh_categoria" name="CNH_Categoria">
                <option value="">Selecione...</option>
                <option value="D">D - Transporte de Passageiros</option>
                <option value="E">E - Transporte de Cargas e Passageiros</option>
 </select>
 </div>
            <div class="form-group">
              <label for="cnh_vencimento" class="form-label">Vencimento da CNH <i class="fas fa-exclamation-triangle"  style="color: orange" title="Documento obrigat√≥rio e essencial"></i></label>
              <input type="date" class="form-control" id="cnh_vencimento" name="CNH_Vencimento">
              <small class="form-help-text">CNH vencida impede opera√ß√£o do ve√≠culo. Monitore vencimentos!</small>
 </div>
 </div>
 </fieldset>

 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-map-marker-alt"></i> Endere√ßo</legend>
          <div class="w-full form-grid">
            <div class="form-group"  style="grid-column: 1 / -1">
              <label for="endereco" class="form-label">Endere√ßo Completo *</label>
              <input type="text" class="form-control" id="endereco" name="Endereco" required>
 </div>
            <div class="form-group">
              <label for="cep" class="form-label">CEP *</label>
              <input type="text" class="form-control" id="cep-1" name="CEP" placeholder="00000-000" required>
 </div>
 </div>
 </fieldset>

 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-first-aid"></i> Contato de Emerg√™ncia</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="emergencia_contato" class="form-label">Nome do Contato</label>
              <input type="text" class="form-control" id="emergencia_contato" name="Emergencia_Contato">
 </div>
            <div class="form-group">
              <label for="emergencia_telefone" class="form-label">Telefone do Contato</label>
              <input type="tel" class="form-control" id="emergencia_telefone" name="Emergencia_Telefone" placeholder="(00) 00000-0000">
 </div>
 </div>

 </form>
</div>

 <script>
// ============================================================================
// Inicializa√ß√£o do Formul√°rio de Pessoal
// ============================================================================
 function toggleCNHFields() {
      const cargo = document.getElementById('cargo').value;
      const cnhFields = document.getElementById('cnhFields');

      if (cargo === 'Motorista') {
        cnhFields.style.display = 'block';
        document.getElementById('cnh_numero').required = true;
        document.getElementById('cnh_categoria').required = true;
        document.getElementById('cnh_vencimento').required = true;
 } else {
        cnhFields.style.display = 'none';
        document.getElementById('cnh_numero').required = false;
        document.getElementById('cnh_categoria').required = false;
        document.getElementById('cnh_vencimento').required = false;
 }
 }

 // Inicializa√ß√£o quando o formul√°rio √© carregado
    document.addEventListener('DOMContentLoaded', function() {
        console.log('[Form-Pessoal] Inicializando formul√°rio');
        
        // Aplica m√°scaras de input
        if (window.InputMasksManager) {
            window.InputMasksManager.applyMask('cpf', 'cpf');
            window.InputMasksManager.applyMask('telefone', 'phone');
            window.InputMasksManager.applyMask('cep', 'cep');
            window.InputMasksManager.applyMask('emergencia_telefone', 'phone');
        }
        
        // Aplica valida√ß√µes customizadas
        if (window.CustomValidator) {
            window.CustomValidator.applyValidation('cpf', 'cpf');
            window.CustomValidator.applyValidation('telefone', 'phone');
            window.CustomValidator.applyValidation('emergencia_telefone', 'phone');
        }
        
        // Configura submit universal do formul√°rio
        if (window.UniversalFormSubmit) {
            window.UniversalFormSubmit.setup('pessoalForm', 'Pessoal', {
                successMessage: 'Cadastro de pessoal salvo com sucesso!',
                clearFormAfterSuccess: true,
                onSuccess: async (result) => {
                    console.log('[Form-Pessoal] Pessoal salvo:', result);
                    toggleCNHFields(); // Reset CNH fields visibility
                },
                beforeSubmit: async (form) => {
                    const cargo = document.getElementById('cargo').value;
                    
                    // Valida CNH para motoristas
                    if (cargo === 'Motorista') {
                        const cnhNumero = document.getElementById('cnh_numero').value;
                        const cnhCategoria = document.getElementById('cnh_categoria').value;
                        const cnhVencimento = document.getElementById('cnh_vencimento').value;
                        
                        if (!cnhNumero || !cnhCategoria || !cnhVencimento) {
                            if (window.ToastManager) {
                                window.ToastManager.show(
                                    'Motoristas devem ter CNH completa preenchida.',
                                    'warning'
                                );
                            }
                            return false;
                        }
                        
                        // Valida se CNH est√° vencida
                        const hoje = new Date();
                        const vencimento = new Date(cnhVencimento);
                        
                        if (vencimento < hoje) {
                            if (window.ToastManager) {
                                window.ToastManager.show(
                                    'A CNH est√° vencida. N√£o √© permitido cadastrar motorista com CNH vencida.',
                                    'error'
                                );
                            }
                            return false;
                        }
                    }
                    
                    return true;
                }
            });
        }
        
        console.log('[Form-Pessoal] Formul√°rio inicializado com sucesso');
    });
 </script>
</div>



<!--============================================================================-->
<!-- ARQUIVO: Form-Rotas.html -->
<!--============================================================================-->

<!-- Form-Rotas.html - Fragmento de formul√°rio inclu√≠do no index.html via formUrl -->
<div class="form-container"> <!-- Wrapper para o conte√∫do do formul√°rio -->

    <div class="alert alert-info mb-4" role="alert" >
      <i class="fas fa-shield-alt"></i>
 <div>
 <strong>Portaria n¬∫ 192/2019 - Crit√©rios de Elegibilidade:</strong>
        <p  class="mt-2" style="font-size: 0.9rem">O transporte atende estudantes de 4 a 17 anos que residam a mais de 2km da UE, em local sem transporte p√∫blico coletivo, n√£o benefici√°rios do Passe Livre Estudantil e com CPF pr√≥prio. A oferta √© residual e suplementar, dependendo de percurso e vaga dispon√≠vel.</p>
 </div>
 </div>

      <form id="rota-form-1" class="card-body">
 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-route"></i> Informa√ß√µes da Rota</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="nome_rota" class="form-label">Nome da Rota *</label>
              <input type="text" class="form-control" id="nome_rota-1" name="Nome_Rota" placeholder="Ex: Taguatinga Norte - Escola Central" required>
 </div>
            <div class="form-group">
              <label for="codigo" class="form-label">C√≥digo *</label>
              <input type="text" class="form-control" id="codigo-1" name="Codigo" placeholder="Ex: TGN-EC" required>
 </div>
            <div class="form-group"  style="grid-column: 1 / -1">
              <label for="descricao" class="form-label">Descri√ß√£o</label>
              <textarea class="form-control" id="descricao-1" name="Descricao" rows="2" placeholder="Descri√ß√£o da rota"></textarea>
 </div>
 </div>
 </fieldset>

 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-users-cog"></i> Equipe e Ve√≠culo</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="veiculo_id" class="form-label">Ve√≠culo Designado *</label>
              <select class="form-control" id="veiculo_id-2" name="Veiculo_ID" required>
                <option value="">Carregando ve√≠culos...</option>
 </select>
 </div>
            <div class="form-group">
              <label for="motorista_id" class="form-label">Motorista *</label>
              <select class="form-control" id="motorista_id-1" name="Motorista_ID" required>
                <option value="">Carregando motoristas...</option>
 </select>
 </div>
            <div class="form-group">
              <label for="monitor_id" class="form-label">Monitor *</label>
              <select class="form-control" id="monitor_id-1" name="Monitor_ID" required>
                <option value="">Carregando monitores...</option>
 </select>
 </div>
 </div>
 </fieldset>

 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-clock"></i> Hor√°rios e M√©tricas</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="horario_inicio" class="form-label">Hor√°rio de In√≠cio *</label>
              <input type="time" class="form-control" id="horario_inicio-1" name="Horario_Inicio" required>
 </div>
            <div class="form-group">
              <label for="horario_fim" class="form-label">Hor√°rio de T√©rmino *</label>
              <input type="time" class="form-control" id="horario_fim-1" name="Horario_Fim" required>
 </div>
            <div class="form-group">
              <label for="distancia_km" class="form-label">Dist√¢ncia (km) *</label>
              <input type="number" step="0.1" class="form-control" id="distancia_km-1" name="Distancia_KM" required>
 </div>
            <div class="form-group">
              <label for="tempo_estimado" class="form-label">Tempo Estimado (minutos) *</label>
              <input type="number" class="form-control" id="tempo_estimado-1" name="Tempo_Estimado" required>
 </div>
            <div class="form-group">
              <label for="capacidade_maxima" class="form-label">Capacidade M√°xima de Alunos *</label>
              <input type="number" class="form-control" id="capacidade_maxima-1" name="Capacidade_Maxima" required>
              <small class="form-help-text">N√£o pode exceder a capacidade do ve√≠culo designado</small>
 </div>
 </div>
 </fieldset>

 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-map-marker-alt"></i> Itiner√°rio e Status</legend>
          <div class="w-full form-grid">
            <div class="form-group"  style="grid-column: 1 / -1">
              <label for="pontos_parada" class="form-label">Pontos de Parada</label>
              <textarea class="form-control" id="pontos_parada-1" name="Pontos_Parada" rows="3" placeholder="Ex: P1:Terminal;P2:Shopping;P3:Escola"></textarea>
 </div>
            <div class="form-group">
              <label for="nivel_dificuldade" class="form-label">N√≠vel de Dificuldade</label>
              <select class="form-control" id="nivel_dificuldade-1" name="Nivel_Dificuldade">
                <option value="Baixo">Baixo</option>
                <option value="M√©dio">M√©dio</option>
                <option value="Alto">Alto</option>
 </select>
 </div>
            <div class="form-group">
              <label for="status" class="form-label">Status</label>
              <select class="form-control" id="status-2" name="Status">
                <option value="Ativa">Ativa</option>
                <option value="Inativa">Inativa</option>
                <option value="Manuten√ß√£o">Manuten√ß√£o</option>
 </select>
 </div>
            <div class="form-group"  style="grid-column: 1 / -1">
              <label for="observacoes" class="form-label">Observa√ß√µes</label>
              <textarea class="form-control" id="observacoes-2" name="Observacoes" rows="2"></textarea>
 </div>
 </div>
 </fieldset>

 </form>
</div>

<script>
// ============================================================================
// Inicializa√ß√£o do Formul√°rio de Rotas
// ============================================================================
document.addEventListener('DOMContentLoaded', async function() {
    console.log('[Form-Rotas] Inicializando formul√°rio');
    
    // Popula dropdowns automaticamente em paralelo
    if (window.DropdownPopulator) {
        await window.DropdownPopulator.populateMultiple([
            { selectId: 'veiculo_id', configKey: 'Veiculos' },
            { selectId: 'motorista_id', configKey: 'Pessoal_Motoristas' },
            { selectId: 'monitor_id', configKey: 'Pessoal_Monitores' }
        ]);
    }
    
    // Valida√ß√£o de capacidade do ve√≠culo
    const veiculoSelect = document.getElementById('veiculo_id');
    const capacidadeInput = document.getElementById('capacidade_maxima');
    
    if (veiculoSelect && capacidadeInput) {
        veiculoSelect.addEventListener('change', function() {
            if (window.DropdownPopulator) {
                const veiculoData = window.DropdownPopulator.getSelectedData('veiculo_id');
                if (veiculoData && veiculoData.Capacidade_Total) {
                    capacidadeInput.max = veiculoData.Capacidade_Total;
                    capacidadeInput.placeholder = `M√°x: ${veiculoData.Capacidade_Total} passageiros`;
                    
                    if (window.ToastManager) {
                        window.ToastManager.show(
                            `Ve√≠culo ${veiculoData.Placa}: capacidade ${veiculoData.Capacidade_Total} passageiros`,
                            'info'
                        );
                    }
                }
            }
        });
        
        capacidadeInput.addEventListener('blur', function() {
            const max = parseInt(capacidadeInput.max) || 999;
            const value = parseInt(capacidadeInput.value) || 0;
            
            if (value > max) {
                if (window.ToastManager) {
                    window.ToastManager.show(
                        `Capacidade m√°xima excedida! O ve√≠culo suporta apenas ${max} passageiros.`,
                        'warning'
                    );
                }
                capacidadeInput.classList.add('is-invalid');
            } else {
                capacidadeInput.classList.remove('is-invalid');
            }
        });
    }
    
    // Configura submit universal do formul√°rio
    if (window.UniversalFormSubmit) {
        window.UniversalFormSubmit.setup('rota-form', 'Rotas', {
            successMessage: 'Rota salva com sucesso!',
            clearFormAfterSuccess: true,
            onSuccess: async (result) => {
                console.log('[Form-Rotas] Rota salva:', result);
            },
            beforeSubmit: async (form) => {
                // Valida√ß√£o de capacidade
                const capacidade = parseInt(document.getElementById('capacidade_maxima').value) || 0;
                const maxCapacidade = parseInt(document.getElementById('capacidade_maxima').max) || 999;
                
                if (capacidade > maxCapacidade) {
                    if (window.ToastManager) {
                        window.ToastManager.show(
                            `Capacidade m√°xima da rota (${capacidade}) excede a capacidade do ve√≠culo (${maxCapacidade}).`,
                            'error'
                        );
                    }
                    return false;
                }
                
                // Valida hor√°rios
                const horaInicio = document.getElementById('horario_inicio').value;
                const horaFim = document.getElementById('horario_fim').value;
                
                if (horaInicio && horaFim && horaInicio >= horaFim) {
                    if (window.ToastManager) {
                        window.ToastManager.show(
                            'O hor√°rio de t√©rmino deve ser posterior ao hor√°rio de in√≠cio.',
                            'warning'
                        );
                    }
                    return false;
                }
                
                return true;
            }
        });
    }
    
    console.log('[Form-Rotas] Formul√°rio inicializado com sucesso');
});
</script>
</div>



<!--============================================================================-->
<!-- ARQUIVO: Form-Veiculos.html -->
<!--============================================================================-->

<!-- Form-Veiculos.html - Fragmento de formul√°rio inclu√≠do no index.html via formUrl -->
<div class="form-container"> <!-- Wrapper para o conte√∫do do formul√°rio -->

 <!-- Alerta: Documenta√ß√£o Necess√°ria -->
    <div class="alert alert-warning mb-4" role="alert" >
      <i class="fas fa-exclamation-triangle"></i>
 <div>
 <strong>Aten√ß√£o √† Documenta√ß√£o Obrigat√≥ria:</strong>
        <p  class="mt-2" style="font-size: 0.9rem">Certifique-se de manter atualizados: Ap√≥lice de Seguro, IPVA, Inspe√ß√£o Veicular. Documente as pr√≥ximas manuten√ß√µes preventivas. A falta destes documentos pode impedir pagamentos conforme Termo de Refer√™ncia (44012274).</p>
 </div>
 </div>

      <form id="veiculoForm-1" class="card-body">
 <!-- Identifica√ß√£o -->
 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-id-card"></i> Identifica√ß√£o do Ve√≠culo</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="placa" class="form-label">Placa *</label>
              <input type="text" class="form-control" id="placa-1" name="Placa" placeholder="ABC-1234" required>
 </div>
            <div class="form-group">
              <label for="modelo" class="form-label">Modelo *</label>
              <input type="text" class="form-control" id="modelo-1" name="Modelo" placeholder="Ex: Sprinter 515" required>
 </div>
            <div class="form-group">
              <label for="marca" class="form-label">Marca *</label>
              <input type="text" class="form-control" id="marca-1" name="Marca" placeholder="Ex: Mercedes-Benz" required>
 </div>
            <div class="form-group">
              <label for="ano_fabricacao" class="form-label">Ano de Fabrica√ß√£o *</label>
              <input type="number" class="form-control" id="ano_fabricacao-1" name="Ano_Fabricacao" min="1990" max="2030" required>
 </div>
            <div class="form-group">
              <label for="chassi" class="form-label">Chassi *</label>
              <input type="text" class="form-control" id="chassi-1" name="Chassi" required>
 </div>
            <div class="form-group">
              <label for="renavam" class="form-label">RENAVAM *</label>
              <input type="text" class="form-control" id="renavam-1" name="Renavam" required>
 </div>
 </div>
 </fieldset>

 <!-- Especifica√ß√µes -->
 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-cogs"></i> Especifica√ß√µes</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="capacidade" class="form-label">Capacidade de Passageiros (Sentados) *</label>
              <input type="number" class="form-control" id="capacidade-1" name="Capacidade" min="1" required onchange="calcularCapacidadeTotal()">
              <small class="form-help-text">N√∫mero de assentos dispon√≠veis (excluindo baias)</small>
 </div>
            <div class="form-group">
              <label for="qtd_baias_cadeirante" class="form-label">Quantidade de Baias para Cadeirantes <i class="fas fa-wheelchair"  style="color: var(--md-sys-color-primary)"></i></label>
              <input type="number" class="form-control" id="qtd_baias_cadeirante-1" name="Qtd_Baias_Cadeirante" min="0" value="0" onchange="calcularCapacidadeTotal()">
              <small class="form-help-text"  style="color: var(--md-sys-color-error)"><strong>Obrigat√≥rio para ve√≠culos adaptados.</strong> Cada baia acomoda 1 cadeirante.</small>
 </div>
            <div class="form-group">
              <label for="capacidade_total" class="form-label">Capacidade Total (Calculada)</label>
              <input type="number" class="form-control" id="capacidade_total-1" name="Capacidade_Total" readonly  style="background-color: #f0f0f0">
              <small class="form-help-text">Passageiros sentados + cadeirantes em baias</small>
 </div>
            <div class="form-group">
              <label for="tipo_combustivel" class="form-label">Tipo de Combust√≠vel *</label>
              <select class="form-control" id="tipo_combustivel-1" name="Tipo_Combustivel" required>
                <option value="">Selecione...</option>
                <option value="Diesel">Diesel</option>
                <option value="Gasolina">Gasolina</option>
                <option value="Etanol">Etanol</option>
                <option value="Flex">Flex</option>
                <option value="GNV">GNV</option>
                <option value="El√©trico">El√©trico</option>
 </select>
 </div>
            <div class="form-group">
              <label for="km_atual" class="form-label">KM Atual</label>
              <input type="number" class="form-control" id="km_atual-1" name="KM_Atual" value="0">
 </div>
 </div>
 </fieldset>

 <!-- Acessibilidade -->
 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-universal-access"></i> Acessibilidade e Adapta√ß√µes</legend>
          <div class="alert alert-info mb-3" role="alert" >
            <i class="fas fa-info-circle"></i>
 <div>
 <strong>Lei n¬∫ 13.146/2015 - Lei Brasileira de Inclus√£o (LBI):</strong>
              <p  class="mt-2" style="font-size: 0.9rem">Ve√≠culos de transporte escolar devem garantir acessibilidade a estudantes com defici√™ncia ou mobilidade reduzida. Baias para cadeirantes s√£o essenciais para garantir o direito √† educa√ß√£o inclusiva.</p>
 </div>
 </div>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="possui_elevador" class="form-label">Possui Elevador/Rampa?</label>
              <select class="form-control" id="possui_elevador-1" name="Possui_Elevador">
                <option value="N√£o">N√£o</option>
                <option value="Elevador">Elevador Elevatoric</option>
                <option value="Rampa">Rampa Manual</option>
                <option value="Rampa Autom√°tica">Rampa Autom√°tica</option>
 </select>
 </div>
            <div class="form-group">
              <label for="sistema_fixacao" class="form-label">Sistema de Fixa√ß√£o da Cadeira?</label>
              <select class="form-control" id="sistema_fixacao-1" name="Sistema_Fixacao">
                <option value="N√£o">N√£o Possui</option>
                <option value="Sim">Sim - Cinto de Seguran√ßa Espec√≠fico</option>
 </select>
 </div>
            <div class="form-group"  style="grid-column: 1 / -1">
              <label for="outras_adaptacoes" class="form-label">Outras Adapta√ß√µes de Acessibilidade</label>
              <textarea class="form-control" id="outras_adaptacoes-1" name="Outras_Adaptacoes" rows="2" placeholder="Descreva outras adapta√ß√µes: barras de apoio, piso antiderrapante, sinaliza√ß√£o em braille, etc."></textarea>
 </div>
 </div>
 </fieldset>

 <!-- Documenta√ß√£o -->
 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-file-alt"></i> Documenta√ß√£o</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="vencimento_ipva" class="form-label">Vencimento IPVA <i class="fas fa-info-circle" title="Documento obrigat√≥rio para pagamento"></i></label>
              <input type="date" class="form-control" id="vencimento_ipva-1" name="Vencimento_IPVA">
              <small class="form-help-text">Manter regularizado para evitar bloqueio de pagamentos</small>
 </div>
            <div class="form-group">
              <label for="vencimento_seguro" class="form-label">Vencimento Seguro <i class="fas fa-info-circle" title="Ap√≥lice e comprovante s√£o obrigat√≥rios"></i></label>
              <input type="date" class="form-control" id="vencimento_seguro-1" name="Vencimento_Seguro">
              <small class="form-help-text">Ap√≥lice e comprovante de pagamento s√£o documentos obrigat√≥rios</small>
 </div>
            <div class="form-group">
              <label for="vencimento_inspecao" class="form-label">Vencimento Inspe√ß√£o Veicular <i class="fas fa-info-circle" title="Obrigat√≥rio conforme legisla√ß√£o de tr√¢nsito"></i></label>
              <input type="date" class="form-control" id="vencimento_inspecao-1" name="Vencimento_Inspecao">
              <small class="form-help-text">Inspe√ß√£o em dia garante seguran√ßa dos estudantes</small>
 </div>
            <div class="form-group">
              <label for="proxima_revisao" class="form-label">Pr√≥xima Revis√£o (KM)</label>
              <input type="number" class="form-control" id="proxima_revisao-1" name="Proxima_Revisao">
 </div>
 </div>
 </fieldset>
 <!-- Status e Observa√ß√µes -->
 <fieldset>
          <legend class="section-title-standardized"><i class="fas fa-info-circle"></i> Status e Observa√ß√µes</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="veiculo_adaptado" class="form-label">Ve√≠culo Adaptado? <i class="fas fa-wheelchair"></i></label>
              <select class="form-control" id="veiculo_adaptado-1" name="Veiculo_Adaptado" onchange="alertarBaias()">
                <option value="N√£o">N√£o</option>
                <option value="Sim"> Sim - Possui adapta√ß√µes para acessibilidade</option>
 </select>
              <small class="form-help-text">Ve√≠culos adaptados possuem baias, elevador ou rampa para cadeirantes</small>
 </div>
            <div class="form-group">
              <label for="status" class="form-label">Status do Ve√≠culo *</label>
              <select class="form-control" id="status-2" name="Status" required>
                <option value="Operacional">Operacional</option>
                <option value="Manuten√ß√£o">Em Manuten√ß√£o</option>
                <option value="Inativo">Inativo</option>
                <option value="Reserva">Reserva</option>
 </select>
 </div>
            <div class="form-group"  style="grid-column: 1 / -1">
              <label for="observacoes" class="form-label">Observa√ß√µes</label>
              <textarea class="form-control" id="observacoes-2" name="Observacoes" rows="3"></textarea>
 </div>
 </div>
 </fieldset>

 </form>
</div>

 <script>
// ============================================================================
// Inicializa√ß√£o do Formul√°rio de Ve√≠culos
// ============================================================================
 function calcularCapacidadeTotal() {
      const capacidade = parseInt(document.getElementById('capacidade').value) || 0;
      const baias = parseInt(document.getElementById('qtd_baias_cadeirante').value) || 0;
      document.getElementById('capacidade_total').value = capacidade + baias;
 }

 function alertarBaias() {
      const adaptado = document.getElementById('veiculo_adaptado').value;
      const baias = parseInt(document.getElementById('qtd_baias_cadeirante').value) || 0;

      if (adaptado === 'Sim' && baias === 0) {
        alert(' Aten√ß√£o: Ve√≠culos adaptados devem ter ao menos 1 baia para cadeirantes. Por favor, preencha a quantidade de baias.');
        document.getElementById('qtd_baias_cadeirante').focus();
 }
 }

 // Inicializa√ß√£o quando o formul√°rio √© carregado
    document.addEventListener('DOMContentLoaded', function() {
        console.log('[Form-Veiculos] Inicializando formul√°rio');
        
 calcularCapacidadeTotal();
        
        // Aplica m√°scaras de input
        if (window.InputMasksManager) {
            window.InputMasksManager.applyMask('placa', 'placa');
        }
        
        // Aplica valida√ß√µes customizadas
        if (window.CustomValidator) {
            window.CustomValidator.applyValidation('placa', 'placa');
        }
        
        // Configura submit universal do formul√°rio
        if (window.UniversalFormSubmit) {
            window.UniversalFormSubmit.setup('veiculoForm', 'Veiculos', {
                successMessage: 'Ve√≠culo salvo com sucesso!',
                clearFormAfterSuccess: true,
                onSuccess: async (result) => {
                    console.log('[Form-Veiculos] Ve√≠culo salvo:', result);
                },
                beforeSubmit: async (form) => {
                    // Valida√ß√£o customizada de baias
                    const adaptado = document.getElementById('veiculo_adaptado').value;
                    const baias = parseInt(document.getElementById('qtd_baias_cadeirante').value) || 0;
                    
                    if (adaptado === 'Sim' && baias === 0) {
                        if (window.ToastManager) {
                            window.ToastManager.show(
                                'Ve√≠culos adaptados devem ter ao menos 1 baia para cadeirantes.',
                                'warning'
                            );
                        }
                        document.getElementById('qtd_baias_cadeirante').focus();
                        return false;
                    }
                    return true;
                }
            });
        }
        
        console.log('[Form-Veiculos] Formul√°rio inicializado com sucesso');
 });
 </script>
</div>



<!--============================================================================-->
<!-- ARQUIVO: Form-Viagens.html -->
<!--============================================================================-->

<!-- Form-Viagens.html - Fragmento inclu√≠do no index.html -->
<div class="container">
    <h2 class="page-title"><i class="fas fa-road"></i> Cadastro de Viagem</h2>
    <p class="page-subtitle">Registre uma nova viagem realizada no sistema de transporte escolar.</p>

    <div class="card">
      <form id="viagem-form" class="card-body" onsubmit="handleFormSubmit(event)">
        <fieldset class="form-section">
          <legend class="section-title-standardized"><i class="fas fa-calendar"></i> Informa√ß√µes B√°sicas</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="data" class="form-label">Data da Viagem *</label>
              <input type="date" class="form-control" id="data" name="Data" required>
 </div>
            <div class="form-group">
              <label for="periodo" class="form-label">Per√≠odo *</label>
              <select class="form-control" id="periodo-1" name="Periodo" required>
                <option value="">Selecione o per√≠odo...</option>
                <option value="IDA_MANHA">Ida - Manh√£</option>
                <option value="VOLTA_MANHA">Volta - Manh√£</option>
                <option value="IDA_TARDE">Ida - Tarde</option>
                <option value="VOLTA_TARDE">Volta - Tarde</option>
 </select>
 </div>
            <div class="form-group">
              <label for="id_rota" class="form-label">Rota *</label>
              <select class="form-control" id="id_rota-1" name="ID_Rota" required>
                <option value="">Carregando rotas...</option>
 </select>
 </div>
 </div>
 </fieldset>

        <fieldset class="form-section">
          <legend class="section-title-standardized"><i class="fas fa-users-cog"></i> Equipe e Ve√≠culo</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="id_veiculo" class="form-label">Ve√≠culo *</label>
              <select class="form-control" id="id_veiculo-1" name="ID_Veiculo" required>
                <option value="">Carregando ve√≠culos...</option>
 </select>
 </div>
            <div class="form-group">
              <label for="id_motorista" class="form-label">Motorista *</label>
              <select class="form-control" id="id_motorista" name="ID_Motorista" required>
                <option value="">Carregando motoristas...</option>
 </select>
 </div>
            <div class="form-group">
              <label for="id_monitor" class="form-label">Monitor *</label>
              <select class="form-control" id="id_monitor" name="ID_Monitor" required>
                <option value="">Selecione o monitor...</option>
 </select>
 </div>
 </div>
 </fieldset>

        <fieldset class="form-section">
          <legend class="section-title-standardized"><i class="fas fa-clock"></i> Hor√°rios de Execu√ß√£o</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="horario_inicio_real" class="form-label">Hor√°rio de In√≠cio Real</label>
              <input type="time" class="form-control" id="horario_inicio_real" name="Horario_Inicio_Real">
 </div>
            <div class="form-group">
              <label for="horario_fim_real" class="form-label">Hor√°rio de T√©rmino Real</label>
              <input type="time" class="form-control" id="horario_fim_real" name="Horario_Fim_Real">
 </div>
            <div class="form-group">
              <label for="atraso_minutos" class="form-label">Atraso (minutos)</label>
              <input type="number" class="form-control" id="atraso_minutos" name="Atraso_Minutos" value="0" min="0">
 </div>
 </div>
 </fieldset>

        <fieldset class="form-section">
          <legend class="section-title-standardized"><i class="fas fa-chart-line"></i> M√©tricas e Consumo</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="km_rodados" class="form-label">KM Rodados</label>
              <input type="number" step="0.1" class="form-control" id="km_rodados" name="KM_Rodados" min="0">
 </div>
            <div class="form-group">
              <label for="combustivel_gasto_l" class="form-label">Combust√≠vel Gasto (L)</label>
              <input type="number" step="0.01" class="form-control" id="combustivel_gasto_l" name="Combustivel_Gasto_L" min="0">
 </div>
            <div class="form-group">
              <label for="alunos_transportados" class="form-label">Alunos Transportados</label>
              <input type="number" class="form-control" id="alunos_transportados" name="Alunos_Transportados" value="0" min="0">
 </div>
 </div>
 </fieldset>

        <fieldset class="form-section">
          <legend class="section-title-standardized"><i class="fas fa-info-circle"></i> Status e Observa√ß√µes</legend>
          <div class="w-full form-grid">
            <div class="form-group">
              <label for="status_viagem" class="form-label">Status da Viagem *</label>
              <select class="form-control" id="status_viagem" name="Status_Viagem" required>
                <option value="Agendada">Agendada</option>
                <option value="Em Andamento">Em Andamento</option>
                <option value="Conclu√≠da" selected>Conclu√≠da</option>
                <option value="Cancelada">Cancelada</option>
 </select>
 </div>
            <div class="form-group">
              <label for="clima" class="form-label">Condi√ß√µes Clim√°ticas</label>
              <select class="form-control" id="clima" name="Clima">
                <option value="Sol">Sol</option>
                <option value="Nublado">Nublado</option>
                <option value="Chuva">Chuva</option>
                <option value="Tempestade">Tempestade</option>
 </select>
 </div>
            <div class="form-group"  style="grid-column: 1 / -1">
              <label for="observacoes" class="form-label">Observa√ß√µes</label>
              <textarea class="form-control" id="observacoes-2" name="Observacoes" rows="3" placeholder="Registre incidentes, atrasos ou observa√ß√µes relevantes sobre a viagem"></textarea>
 </div>
 </div>
 </fieldset>

        <div class="card-footer">
          <button type="button" class="btn btn-secondary" onclick="google.script.host.close()">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar Viagem</button>
 </div>
 </form>
 </div>
 </div>
 <script>
    document.addEventListener('DOMContentLoaded', function() {
 // Define a data de hoje como padr√£o
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('data').value = today;

 // Carrega os dados dos selects
 populateSelects();
 });

 async function populateSelects() {
      const rotaSelect = document.getElementById('id_rota');
      const vehicleSelect = document.getElementById('id_veiculo');
      const driverSelect = document.getElementById('id_motorista');
      const monitorSelect = document.getElementById('id_monitor');

 try {
 // Usando Promise.all para carregar dados em paralelo
 const [rotaResult, vehicleResult, staffResult] = await Promise.all([
          API.run('readRecords', { sheetName: 'Rotas', filters: { Status: 'Ativa' } }),
          API.run('readRecords', { sheetName: 'Veiculos', filters: { Status: 'Operacional' } }),
          API.run('readRecords', { sheetName: 'Pessoal', filters: { Status: 'Ativo' } })
 ]);

 // Popula rotas
        rotaSelect.innerHTML = '<option value="">Selecione a rota...</option>';
 (rotaResult || []).forEach(rota => {
 const option = new Option(`${rota.Codigo} - ${rota.Nome_Rota}`, rota.ID);
 rotaSelect.add(option);
 });

 // Popula ve√≠culos
        vehicleSelect.innerHTML = '<option value="">Selecione o ve√≠culo...</option>';
 (vehicleResult || []).forEach(veiculo => {
 const option = new Option(`${veiculo.Placa} - ${veiculo.Modelo}`, veiculo.ID);
 vehicleSelect.add(option);
 });

 // Popula motoristas e monitores
        driverSelect.innerHTML = '<option value="">Selecione o motorista...</option>';
        monitorSelect.innerHTML = '<option value="">Selecione o monitor...</option>';
 (staffResult || []).forEach(pessoa => {
 const option = new Option(pessoa.Nome_Completo, pessoa.ID);
          if (pessoa.Cargo === 'Motorista') {
 driverSelect.add(option.cloneNode(true));
          } else if (pessoa.Cargo === 'Monitor') {
 monitorSelect.add(option.cloneNode(true));
 }
 });

 } catch (error) {
        console.error('Erro ao popular selects:', error);
        ToastManager.show(`Falha ao carregar op√ß√µes: ${error.message}`, 'error');

        rotaSelect.innerHTML = '<option value="">Falha ao carregar rotas</option>';
 rotaSelect.disabled = true;
        vehicleSelect.innerHTML = '<option value="">Falha ao carregar ve√≠culos</option>';
 vehicleSelect.disabled = true;
        driverSelect.innerHTML = '<option value="">Falha ao carregar motoristas</option>';
 driverSelect.disabled = true;
        monitorSelect.innerHTML = '<option value="">Falha ao carregar monitores</option>';
 monitorSelect.disabled = true;
 }
 }

 async function handleFormSubmit(e) {
 e.preventDefault();
      const form = document.getElementById('viagem-form');

 // Valida√ß√£o do formul√°rio
 if (!form.checkValidity()) {
        ToastManager.show('Por favor, preencha todos os campos obrigat√≥rios.', 'warning');
 form.reportValidity();
 return;
 }

 const formData = new FormData(form);
 const viagemData = Object.fromEntries(formData.entries());

      const submitButton = form.querySelector('button[type="submit"]');
 LoadingManager.showButtonLoading(submitButton);

 try {
 // Criar registro na planilha Viagens
        const result = await API.run('createRecord', { sheetName: 'Viagens', data: viagemData });
 if (result.success) {
            ToastManager.show('Viagem registrada com sucesso!', 'success');
 form.reset();

 // Define a data de hoje novamente ap√≥s o reset
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('data').value = today;

 // Se este formul√°rio estiver em um modal, voc√™ pode fech√°-lo aqui
            if (window.parent && typeof window.parent.ModalManager.close === 'function') {
              window.parent.ModalManager.close('form-viagem-modal');
 // E atualizar a tabela na p√°gina principal
              window.parent.CRUDManagerUniversal.loadData('viagens');
            } else if (typeof google.script.host.close === 'function') {
 google.script.host.close();
 }
 } else {
            throw new Error(result.error || "O servidor retornou uma falha ao salvar a viagem.");
 }

 } catch (error) {
        console.error('Erro ao salvar viagem:', error);
        ToastManager.show(`Erro ao salvar: ${error.message}`, 'error');
 } finally {
 LoadingManager.hideButtonLoading(submitButton);
 }
 }
 </script>



<!--============================================================================-->
<!-- ARQUIVO: Table-Alunos.html -->
<!--============================================================================-->

<!-- Table-Alunos.html - Fragmento inclu√≠do no index.html -->
<div class="container">
    <h2 class="page-title"><i class="fas fa-users"></i> Lista de Alunos</h2>
    <p class="page-subtitle">Todos os alunos cadastrados no sistema de transporte escolar.</p>
{{ ... }}
    <div class="crud-actions"  style="margin-bottom: 20px">
      <button class="btn btn-primary" onclick="novoAluno()">
        <i class="fas fa-plus"></i> Novo Aluno
 </button>
      <button class="btn btn-secondary" onclick="atualizarLista()">
        <i class="fas fa-sync"></i> Atualizar
 </button>

      <input type="text" id="searchInput-1" class="form-control" placeholder="Buscar por nome, RA ou rota..."  style="display:inline-block; width:300px; margin-left:10px" onkeyup="filtrarTabela()">
 </div>

    <div id="loading-1" class="text-center"  style="display:none; padding:40px">
      <i class="fas fa-spinner fa-spin fa-2x"></i><p>Carregando alunos...</p>
 </div>

    <table class="data-table" id="alunosTable">
 <thead>
 <tr>
 <th>ID</th>
 <th>Nome</th>
 <th>RA</th>
 <th>Escola</th>
 <th>S√©rie/Ano</th>
 <th>Turno</th>
 <th>Rota</th>
 <th>Status</th>
          <th  class="text-center" style="width: 150px">A√ß√µes</th>
 </tr>
 </thead>
      <tbody id="alunosTableBody">
 <!-- Dados ser√£o inseridos aqui -->
 </tbody>
 </table>

    <div id="emptyState-1" class="empty-state"  style="display:none; padding:40px">
 <p>Nenhum aluno cadastrado ainda.</p>
      <button class="btn btn-primary" onclick="novoAluno()">Cadastrar Primeiro Aluno</button>
 </div>
 </div>

 <script>
 let todosAlunos = [];
    const tableBody = document.getElementById('alunosTableBody');
    const loadingDiv = document.getElementById('loading');
    const tableElement = document.getElementById('alunosTable');
    const emptyStateDiv = document.getElementById('emptyState');

    document.addEventListener('DOMContentLoaded', function() {
 carregarAlunos();
 });

 async function carregarAlunos() {
      loadingDiv.style.display = 'block';
      tableElement.style.display = 'none';
      emptyStateDiv.style.display = 'none';

 try {
        // Usa DynamicDataLoader para buscar dados com cache
        if (typeof window.DataLoader !== 'undefined') {
          todosAlunos = await window.DataLoader.load('Alunos', {}, true); // forceRefresh = true
        } else {
          // Fallback para API direta
          const result = await API.run('readRecords', { sheetName: 'Alunos' });
          todosAlunos = Array.isArray(result) ? result : [];
        }
        
 renderizarTabela(todosAlunos);
        tableElement.style.display = todosAlunos.length > 0 ? '' : 'none';
        emptyStateDiv.style.display = todosAlunos.length === 0 ? 'block' : 'none';
        
        if (window.ToastManager && todosAlunos.length > 0) {
          window.ToastManager.info(`${todosAlunos.length} aluno(s) carregado(s)`, 2000);
        }
 } catch (error) {
        if (window.ToastManager) {
          window.ToastManager.error(`Erro ao carregar alunos: ${error.message}`);
        }
        emptyStateDiv.style.display = 'block';
 } finally {
        loadingDiv.style.display = 'none';
 }
 }

 function renderizarTabela(alunos) {
 if (!tableBody) return;

 const rowsHtml = alunos.map(function(aluno) {
        const statusClass = aluno.Status_Ativo === 'Ativo' ? 'active' : 'inactive';
 return `
          <td>${aluno.ID || ''}</td>
          <td>${aluno.Nome_Completo || ''}</td>
          <td>${aluno.RA_Aluno || ''}</td>
          <td>${aluno.Escola || ''}</td>
          <td>${aluno.Serie_Ano || ''}</td>
          <td>${aluno.Turno || ''}</td>
          <td>${aluno.Rota_ID || ''}</td>
          <td><span class="status-badge ${statusClass}">${aluno.Status_Ativo || 'N/A'}</span></td>
          <td class="action-buttons">
            <button aria-label="Visualizar" class="btn btn-icon btn-sm btn-info" onclick="visualizarAluno('${aluno.ID}')" title="Visualizar">
              <i class="fas fa-eye"></i>
 </button>
            <button aria-label="Editar" class="btn btn-icon btn-sm btn-secondary" onclick="editarAluno('${aluno.ID}')" title="Editar">
              <i class="fas fa-edit"></i>
 </button>
            <button aria-label="Excluir" class="btn btn-icon btn-sm btn-error" onclick="excluirAluno('${aluno.ID}', '${aluno.Nome_Completo}')" title="Excluir">
              <i class="fas fa-trash"></i>
 </button>
 </td>
 `;
      }).join('');

 tableBody.innerHTML = rowsHtml;
 }

 const debouncedFilter = Utils.debounce(filtrarTabela, 300);
    document.getElementById('searchInput').addEventListener('keyup', debouncedFilter);

 function filtrarTabela() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();

 const alunosFiltrados = todosAlunos.filter(aluno => {
 return (
          (aluno.Nome_Completo || '').toLowerCase().includes(searchTerm) ||
          (aluno.RA_Aluno || '').toLowerCase().includes(searchTerm) ||
          (aluno.Rota_ID || '').toLowerCase().includes(searchTerm) ||
          (aluno.Escola || '').toLowerCase().includes(searchTerm)
 );
 });
 renderizarTabela(alunosFiltrados);
 }

 function novoAluno() {
 // Idealmente, isso abriria um modal do sistema principal
      ToastManager.show('Abrindo formul√°rio de novo aluno...', 'info');
      google.script.run.loadPage('Form-Alunos'); // Exemplo de como poderia ser
 }

 function visualizarAluno(id) {
      ToastManager.show('Visualizar aluno ID: ' + id + ' (implementar modal)', 'info');
 }

 async function editarAluno(id) {
      const loadingToast = window.ToastManager ? window.ToastManager.loading('Carregando dados do aluno...') : null;
      
 try {
        // Busca os dados do aluno
        const result = await new Promise((resolve, reject) => {
          google.script.run
            .withSuccessHandler(resolve)
            .withFailureHandler(reject)
            .readRecords({ sheetName: 'Alunos', id: id });
        });

        if (loadingToast) window.ToastManager.hideLoading(loadingToast);

        if (result.success && result.data) {
          const aluno = Array.isArray(result.data) ? result.data[0] : result.data;
          
          // Preenche o formul√°rio com os dados existentes
          const form = document.getElementById('aluno-form');
          if (!form) {
            window.ToastManager.warning('Formul√°rio n√£o encontrado nesta p√°gina');
            return;
          }

          document.getElementById('nome_completo').value = aluno.Nome_Completo || '';
          document.getElementById('ra_aluno').value = aluno.RA_Aluno || '';
          document.getElementById('data_nascimento').value = aluno.Data_Nascimento || '';
          document.getElementById('cpf').value = aluno.CPF || '';
          document.getElementById('rg').value = aluno.RG || '';
          document.getElementById('escola').value = aluno.Escola || '';
          document.getElementById('serie_ano').value = aluno.Serie_Ano || '';
          document.getElementById('turno').value = aluno.Turno || '';
          document.getElementById('endereco_residencial').value = aluno.Endereco_Residencial || '';
          document.getElementById('cep').value = aluno.CEP || '';
          document.getElementById('bairro').value = aluno.Bairro || '';
          document.getElementById('rota_id').value = aluno.ID_Rota || '';
          document.getElementById('ponto_embarque').value = aluno.Ponto_Embarque || '';
          document.getElementById('ponto_desembarque').value = aluno.Ponto_Desembarque || '';
          document.getElementById('responsavel1_nome').value = aluno.Responsavel1_Nome || '';
          document.getElementById('responsavel1_telefone').value = aluno.Responsavel1_Telefone || '';
          document.getElementById('responsavel2_nome').value = aluno.Responsavel2_Nome || '';
          document.getElementById('responsavel2_telefone').value = aluno.Responsavel2_Telefone || '';
          document.getElementById('necessidades_especiais').value = aluno.Necessidades_Especiais || 'N√£o';
          document.getElementById('status_ativo').value = aluno.Status_Ativo || 'Ativo';
          
          if (document.getElementById('medicamentos')) {
            document.getElementById('medicamentos').value = aluno.Medicamentos || '';
          }

          // Armazena o ID do aluno sendo editado
          form.dataset.editingId = id;
          
          // Muda o texto do bot√£o de submit
          const submitBtn = form.querySelector('button[type="submit"]');
          if (submitBtn) {
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Atualizar Aluno';
          }
          
          // Rola para o topo do formul√°rio
          window.scrollTo({ top: 0, behavior: 'smooth' });
          
          window.ToastManager.success('Dados carregados. Edite e salve.');
        } else {
          window.ToastManager.error('Erro ao carregar dados do aluno: ' + (result.error || 'Aluno n√£o encontrado'));
        }
 } catch (error) {
        if (loadingToast) window.ToastManager.hideLoading(loadingToast);
        window.ToastManager.error('Erro ao buscar aluno: ' + error.message);
 }
 }

 async function excluirAluno(id, nome) {
      if (confirm('Deseja realmente excluir o aluno "' + nome + '"?\n\nEsta a√ß√£o n√£o pode ser desfeita.')) {
        LoadingManager.show('Excluindo aluno...');
 try {
          await API.run('deleteRecord', { sheetName: 'Alunos', id: id });
          ToastManager.show('Aluno exclu√≠do com sucesso!', 'success');
 carregarAlunos();
 } catch (error) {
          ToastManager.show(`Erro ao excluir aluno: ${error.message}`, 'error');
 } finally {
 LoadingManager.hide();
 }
 }
 }

 function atualizarLista() {
 carregarAlunos();
 }
 </script>
</div>



<!--============================================================================-->
<!-- ARQUIVO: Table-Rotas.html -->
<!--============================================================================-->

<!-- Table-Rotas.html - Fragmento inclu√≠do no index.html -->
<div class="container">
    <h2 class="page-title"><i class="fas fa-route"></i> Lista de Rotas</h2>
    <p class="page-subtitle">Todas as rotas de transporte escolar cadastradas.</p>

    <div  style="margin-bottom: 20px">
      <button class="btn btn-primary" onclick="novaRota()">
        <i class="fas fa-plus"></i> Nova Rota
 </button>
      <button class="btn btn-secondary" onclick="atualizarLista()">
        <i class="fas fa-sync"></i> Atualizar
 </button>

      <input type="text" id="searchInput-1" class="form-control" placeholder="Buscar por nome, c√≥digo..."  style="display:inline-block; width:300px; margin-left:10px">
 </div>

    <div id="loading-1" class="text-center"  style="display:none; padding:40px">
      <i class="fas fa-spinner fa-spin fa-2x"></i><p>Carregando rotas...</p>
 </div>

    <table class="data-table" id="rotasTable">
 <thead>
 <tr>
 <th>C√≥digo</th>
 <th>Nome</th>
 <th>Ve√≠culo</th>
 <th>Motorista</th>
 <th>Hor√°rio</th>
 <th>Dist√¢ncia</th>
 <th>Alunos</th>
 <th>Status</th>
          <th  style="width: 150px">A√ß√µes</th>
 </tr>
 </thead>
      <tbody id="rotasTableBody">
 </tbody>
 </table>

    <div id="emptyState-1" class="empty-state"  style="display:none; padding:40px">
 <p>Nenhuma rota cadastrada.</p>
      <button class="btn btn-primary" onclick="novaRota()">Cadastrar Primeira Rota</button>
 </div>
 </div>

 <script>
 let todasRotas = [];

    document.addEventListener('DOMContentLoaded', function() {
 carregarRotas();
 });

 function carregarRotas() {
      document.getElementById('loading').style.display = 'block';
      document.getElementById('rotasTable').style.display = 'none';
      document.getElementById('emptyState').style.display = 'none';

 google.script.run
 .withSuccessHandler(function(result) {
          document.getElementById('loading').style.display = 'none';
 if (result.success && result.data && result.data.length > 0) {
 todasRotas = result.data;
 renderizarTabela(todasRotas);
 } else {
            document.getElementById('emptyState').style.display = 'block';
            document.getElementById('rotasTable').style.display = 'none';
 }
 })
        .readRecords(null, {}, 'Rotas');
 }

 function renderizarTabela(rotas) {
      const tbody = document.getElementById('rotasTableBody');
      tbody.innerHTML = '';

 rotas.forEach(function(rota) {
        const tr = document.createElement('tr');
        const statusClass = rota.Status === 'Ativa' ? 'active' : 'inactive';

 tr.innerHTML = `
          <td><strong>${rota.Codigo || ''}</strong></td>
          <td>${rota.Nome_Rota || ''}</td>
          <td>${rota.Veiculo_ID || '-'}</td>
          <td>${rota.Motorista_ID || '-'}</td>
          <td>${rota.Horario_Inicio || ''} - ${rota.Horario_Fim || ''}</td>
 <td>${rota.Distancia_KM || 0} km</td>
 <td>${rota.Alunos_Ativos || 0} / ${rota.Capacidade_Maxima || 0}</td>
          <td><span class="status-badge ${statusClass}">${rota.Status || 'N/A'}</span></td>
          <td class="action-buttons">
            <button aria-label="Editar" class="btn btn-sm btn-secondary" onclick="editarRota('${rota.ID}')" title="Editar">
              <i class="fas fa-edit"></i>
 </button>
            <button aria-label="Excluir" class="btn btn-sm btn-danger" onclick="excluirRota('${rota.ID}', '${rota.Nome_Rota}')" title="Excluir">
              <i class="fas fa-trash"></i>
 </button>
 </td>
 `;

 tbody.appendChild(tr);
 });

      document.getElementById('rotasTable').style.display = '';
 }

 function filtrarTabela() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
 const rotasFiltradas = todasRotas.filter(rota => {
 return (
          (rota.Nome_Rota || '').toLowerCase().includes(searchTerm) ||
          (rota.Codigo || '').toLowerCase().includes(searchTerm)
 );
 });
 renderizarTabela(rotasFiltradas);
 }

 function novaRota() {
      CRUDManagerUniversal.openCreateModal('rotas');
 }

 function editarRota(id) {
      CRUDManagerUniversal.openEditModal('rotas', id);
 }

 function excluirRota(id, nome) {
      if (confirm('Deseja realmente excluir a rota "' + nome + '"?')) {
 google.script.run
 .withSuccessHandler(function(result) {
 if (result.success) {
              ToastManager.show('Rota exclu√≠da com sucesso!', 'success');
 carregarRotas();
 } else {
              ToastManager.show('Erro ao excluir: ' + result.error, 'error');
 }
 })
          .deleteRecord(id, 'Rotas');
 }
 }

 function atualizarLista() {
 carregarRotas();
 }

    document.getElementById('searchInput').addEventListener('keyup', filtrarTabela);
 </script>
</div>



<!--============================================================================-->
<!-- ARQUIVO: Table-Veiculos.html -->
<!--============================================================================-->

<!-- Table-Veiculos.html - Fragmento inclu√≠do no index.html -->
<div class="container">
    <h2 class="page-title"><i class="fas fa-bus"></i> Lista de Ve√≠culos</h2>
    <p class="page-subtitle">Frota completa de ve√≠culos de transporte escolar.</p>

    <div  style="margin-bottom: 20px">
      <button class="btn btn-primary" onclick="novoVeiculo()">
        <i class="fas fa-plus"></i> Novo Ve√≠culo
 </button>
      <button class="btn btn-secondary" onclick="atualizarLista()">
        <i class="fas fa-sync"></i> Atualizar
 </button>

      <select id="statusFilter" class="form-control"  style="display:inline-block; width:auto; max-width:200px; margin-left:10px; vertical-align: middle" onchange="filtrarTabela()">
        <option value="">Todos os Status</option>
        <option value="Operacional">Operacional</option>
        <option value="Manuten√ß√£o">Manuten√ß√£o</option>
        <option value="Inativo">Inativo</option>
 </select>
 </div>

    <div id="loading-1" class="text-center"  style="display:none; padding:40px">
      <i class="fas fa-spinner fa-spin fa-2x"></i><p>Carregando ve√≠culos...</p>
 </div>

    <table class="data-table" id="veiculosTable">
 <thead>
 <tr>
 <th>Placa</th>
 <th>Modelo</th>
 <th>Marca</th>
 <th>Ano</th>
 <th>Capacidade</th>
 <th>KM Atual</th>
 <th>Status</th>
          <th  style="width: 150px">A√ß√µes</th>
 </tr>
 </thead>
      <tbody id="veiculosTableBody">
 </tbody>
 </table>

    <div id="emptyState-1" class="empty-state"  style="display:none; padding:40px">
 <p>Nenhum ve√≠culo cadastrado.</p>
      <button class="btn btn-primary" onclick="novoVeiculo()">Cadastrar Primeiro Ve√≠culo</button>
 </div>
 </div>

 <script>
 let todosVeiculos = [];

    document.addEventListener('DOMContentLoaded', function() {
 carregarVeiculos();
 });

 function carregarVeiculos() {
      document.getElementById('loading').style.display = 'block';
      document.getElementById('veiculosTable').style.display = 'none';
      document.getElementById('emptyState').style.display = 'none';

 google.script.run
 .withSuccessHandler(function(result) {
          document.getElementById('loading').style.display = 'none';
 if (result.success && result.data && result.data.length > 0) {
 todosVeiculos = result.data;
 renderizarTabela(todosVeiculos);
 } else if (result.success) {
            document.getElementById('emptyState').style.display = 'block';
            document.getElementById('veiculosTable').style.display = 'none';
 }
 })
        .readRecords(null, {}, 'Veiculos');
 }

 function renderizarTabela(veiculos) {
      const tbody = document.getElementById('veiculosTableBody');
      tbody.innerHTML = '';

 veiculos.forEach(function(veiculo) {
        const tr = document.createElement('tr');
        let statusClass = 'inactive';
        if (veiculo.Status === 'Operacional') statusClass = 'active';
        else if (veiculo.Status === 'Manuten√ß√£o') statusClass = 'warning';
        else if (veiculo.Status === 'Inativo') statusClass = 'error';

 tr.innerHTML = `
          <td><strong>${veiculo.Placa || ''}</strong></td>
          <td>${veiculo.Modelo || ''}</td>
          <td>${veiculo.Marca || ''}</td>
          <td>${veiculo.Ano_Fabricacao || ''}</td>
 <td>${veiculo.Capacidade || 0}</td>
 <td>${veiculo.KM_Atual || 0} km</td>
          <td><span class="status-badge ${statusClass}">${veiculo.Status || 'N/A'}</span></td>
          <td class="action-buttons">
            <button aria-label="Editar" class="btn btn-sm btn-secondary" onclick="editarVeiculo('${veiculo.ID}')" title="Editar">
              <i class="fas fa-edit"></i>
 </button>
            <button aria-label="Excluir" class="btn btn-sm btn-danger" onclick="excluirVeiculo('${veiculo.ID}', '${veiculo.Placa}')" title="Excluir">
              <i class="fas fa-trash"></i>
 </button>
 </td>
 `;

 tbody.appendChild(tr);
 });

      document.getElementById('veiculosTable').style.display = '';
 }

 function filtrarTabela() {
      const statusFilter = document.getElementById('statusFilter').value;

 let veiculosFiltrados = todosVeiculos;
 if (statusFilter) {
 veiculosFiltrados = todosVeiculos.filter(v => v.Status === statusFilter);
 }

 renderizarTabela(veiculosFiltrados);
 }

 function novoVeiculo() {
      CRUDManagerUniversal.openCreateModal('veiculos');
 }

 function editarVeiculo(id) {
      CRUDManagerUniversal.openEditModal('veiculos', id);
 }

 function excluirVeiculo(id, placa) {
      if (confirm(`Tem certeza que deseja excluir o ve√≠culo "${placa}"? Esta a√ß√£o n√£o pode ser desfeita.`)) {
 google.script.run
 .withSuccessHandler(function(result) {
 if (result.success) {
              ToastManager.show('Ve√≠culo exclu√≠do com sucesso!', 'success');
 carregarVeiculos();
 } else {
              ToastManager.show(`Erro ao excluir: ${result.error}`, 'error');
 }
 })
          .deleteRecord(id, 'Veiculos');
 }
 }

 function atualizarLista() {
 carregarVeiculos();
 }
 </script>
</div>


